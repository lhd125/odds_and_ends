<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¢…í•© ì„ í˜•ëŒ€ìˆ˜í•™ í”Œë«í¼ v3</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --sidebar-bg: #1a202c; --sidebar-text: #e2e8f0; --active-link: #3182ce;
            --content-bg: #edf2f7; --primary-btn: #2b6cb0; --text-color: #2d3748;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; height: 100vh; color: var(--text-color); }

        .sidebar { width: 260px; background-color: var(--sidebar-bg); color: var(--sidebar-text); padding: 1.5rem; display: flex; flex-direction: column; overflow-y: auto;}
        .brand { font-size: 1.3rem; font-weight: bold; margin-bottom: 2rem; color: #63b3ed; text-align: center; padding-bottom: 1rem; border-bottom: 1px solid #4a5568;}
        .menu-list { list-style: none; padding: 0; margin: 0; }
        .menu-item { padding: 12px 15px; cursor: pointer; border-radius: 6px; margin-bottom: 5px; transition: 0.2s; font-size: 0.95rem; }
        .menu-item:hover { background-color: rgba(255,255,255,0.1); }
        .menu-item.active { background-color: var(--active-link); color: white; font-weight: bold; }

        .main-content { flex-grow: 1; background-color: var(--content-bg); padding: 2rem; overflow-y: auto; }
        .content-title { font-size: 1.6rem; color: var(--primary-btn); margin-top: 0; margin-bottom: 1.5rem; border-bottom: 2px solid #cbd5e0; padding-bottom: 10px;}

        .inputs-container { display: flex; flex-wrap: wrap; gap: 1.5rem; margin-bottom: 1.5rem; }
        .matrix-card { background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); flex: 1; min-width: 250px; }
        .matrix-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-weight: bold; font-size: 1.1rem;}
        
        .size-input { width: 45px; padding: 4px; text-align: center; border: 1px solid #cbd5e0; border-radius: 4px; }
        .matrix-grid { display: grid; gap: 4px; padding: 10px; position: relative; justify-content: center;}
        .matrix-grid::before, .matrix-grid::after { content: ''; position: absolute; top: 0; bottom: 0; width: 6px; border: 2px solid #2d3748; }
        .matrix-grid::before { left: 0; border-right: none; }
        .matrix-grid::after { right: 0; border-left: none; }
        .matrix-cell { width: 50px; height: 35px; text-align: center; border: 1px solid #e2e8f0; border-radius: 4px; }
        .matrix-cell:focus { border-color: #3182ce; outline: none; background-color: #ebf8ff;}

        .actions-card { background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        .custom-expression { display: flex; gap: 10px; margin-bottom: 15px; align-items: center;}
        .expr-input { flex-grow: 1; padding: 10px; font-size: 1.1rem; border: 2px solid #cbd5e0; border-radius: 6px; font-family: monospace;}
        
        .btn-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .btn { padding: 10px 16px; border: none; border-radius: 6px; background-color: var(--primary-btn); color: white; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn:hover { background-color: #2c5282; }
        .btn-green { background-color: #38a169; } .btn-green:hover { background-color: #276749; }

        .result-section { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: none; }
        
        /* ì‚¬ìš©ëœ ìˆ˜í•™ ê°œë… ëª…ì‹œ ì˜ì—­ */
        .method-desc { background: #e6fffa; border-left: 4px solid #319795; padding: 12px 15px; margin-bottom: 15px; border-radius: 4px; color: #234e52; font-size: 0.95rem; line-height: 1.5;}
        
        .katex-output { font-size: 1.4rem; padding: 1.5rem; background: #f7fafc; border-radius: 8px; overflow-x: auto; text-align: center; border: 1px solid #e2e8f0; margin-bottom: 15px;}
        
        /* ì†”ë£¨ì…˜ ê³¼ì • ì˜ì—­ (í•­ìƒ ë Œë”ë§ë˜ë‚˜ ë‚´ìš©ì€ ë°”ë€œ) */
        .solution-box { background: #fffaf0; border: 1px solid #feebc8; border-radius: 8px; padding: 15px; }
        .solution-title { font-weight: bold; color: #dd6b20; margin-top: 0; margin-bottom: 10px; border-bottom: 1px solid #fbd38d; padding-bottom: 8px;}
        .solution-steps { font-family: 'Courier New', monospace; font-size: 0.95rem; line-height: 1.6; }
        .no-step-msg { color: #a0aec0; font-style: italic; font-size: 0.9rem; }
        
        .error-msg { color: #e53e3e; font-weight: bold; text-align: center; margin-top: 10px;}
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="brand">Linear Algebra Pro</div>
        <ul class="menu-list">
            <li class="menu-item active" onclick="switchTab('custom')">ğŸ“Œ ë‹¤ì¤‘ í–‰ë ¬ ììœ  ìˆ˜ì‹ (A, B, C)</li>
            <li class="menu-item" onclick="switchTab('rref_basis')">ğŸ“Œ ê°€ìš°ìŠ¤ ì†Œê±° ë° ê¸°ì € (Basis)</li>
            <li class="menu-item" onclick="switchTab('det_inv')">ğŸ“Œ í–‰ë ¬ì‹ê³¼ ì—­í–‰ë ¬</li>
            <li class="menu-item" onclick="switchTab('eigen')">ğŸ“Œ ê³ ìœ³ê°’ê³¼ ëŒ€ê°í™”</li>
        </ul>
    </nav>

    <main class="main-content">
        <h2 id="tab-title" class="content-title">ììœ  ìˆ˜ì‹ ê³„ì‚°ê¸°</h2>

        <div id="matrix-container" class="inputs-container"></div>
        <div id="action-container" class="actions-card"></div>

        <div id="result-area" class="result-section">
            <h3 style="margin-top:0; margin-bottom:15px;">ê³„ì‚° ê²°ê³¼</h3>
            
            <div id="method-desc" class="method-desc" style="display:none;"></div>
            
            <div id="katex-display" class="katex-output"></div>
            
            <div class="solution-box">
                <div class="solution-title">ğŸ§ í’€ì´ ê³¼ì • (Solution)</div>
                <div id="solution-steps" class="solution-steps">
                    </div>
            </div>
            
            <div id="error-display" class="error-msg"></div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.3.0/math.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <script>
        let currentTab = 'custom';

        const tabConfigs = {
            'custom': {
                title: "ë‹¤ì¤‘ í–‰ë ¬ ììœ  ìˆ˜ì‹ (ì—°ë¦½ ë° ë³µí•© ì—°ì‚°)",
                matrices: ['A', 'B', 'C'],
                renderActions: () => `
                    <div style="margin-bottom:10px; color:#4a5568; font-size:0.9rem;">
                        ğŸ’¡ <b>ì‚¬ìš©ë²•:</b> ì•„ë˜ ì¹¸ì— ì‹ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: <code>A * B + inv(C)</code>, <code>det(A) * B</code>)
                    </div>
                    <div class="custom-expression">
                        <input type="text" id="custom-expr" class="expr-input" placeholder="ì˜ˆ: A * B + C" value="A * B">
                        <button class="btn btn-green" onclick="evaluateExpression()">ê³„ì‚° ì‹¤í–‰</button>
                    </div>
                `
            },
            'rref_basis': {
                title: "ê°€ìš°ìŠ¤-ì¡°ë¥´ë‹¨ ì†Œê±°ë²• ë° ê¸°ì €(Basis) ì¶”ì¶œ",
                matrices: ['A'],
                renderActions: () => `
                    <div class="btn-group">
                        <button class="btn" onclick="runRREF('rref')">ê¸°ì•½ í–‰ ì‚¬ë‹¤ë¦¬ê¼´ (RREF)</button>
                        <button class="btn" onclick="runRREF('col_basis')">ì—´ ê³µê°„ ê¸°ì € (Column Basis)</button>
                    </div>
                `
            },
            'det_inv': {
                title: "í–‰ë ¬ì‹ê³¼ ì—­í–‰ë ¬",
                matrices: ['A'],
                renderActions: () => `
                    <div class="btn-group">
                        <button class="btn" onclick="calcStandard('det')">í–‰ë ¬ì‹ (Determinant)</button>
                        <button class="btn" onclick="runInverseSteps()">ì—­í–‰ë ¬ (Inverse) - í’€ì´í¬í•¨</button>
                    </div>
                `
            },
            'eigen': {
                title: "ê³ ìœ³ê°’ (Eigenvalues) ë° ê³ ìœ ë²¡í„°",
                matrices: ['A_square'],
                renderActions: () => `
                    <div class="btn-group">
                        <button class="btn" onclick="calcStandard('eigen')">ê³ ìœ³ê°’ ì¶”ì¶œ (Eigenvalues)</button>
                    </div>
                `
            }
        };

        function switchTab(tabId) {
            currentTab = tabId;
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            renderUI();
        }

        function renderUI() {
            const config = tabConfigs[currentTab];
            document.getElementById('tab-title').innerText = config.title;
            const container = document.getElementById('matrix-container');
            container.innerHTML = '';
            config.matrices.forEach(id => {
                let isSquare = id === 'A_square';
                let matName = id.replace('_square', '');
                container.innerHTML += `
                    <div class="matrix-card">
                        <div class="matrix-header">
                            <span>Matrix ${matName}</span>
                            <div>
                                <input type="number" id="rows-${matName}" class="size-input" value="3" min="1" max="5" onchange="generateGrid('${matName}', ${isSquare})"> âœ• 
                                <input type="number" id="cols-${matName}" class="size-input" value="3" min="1" max="5" ${isSquare?'disabled':''} onchange="generateGrid('${matName}', ${isSquare})">
                            </div>
                        </div>
                        <div id="grid-${matName}" class="matrix-grid"></div>
                    </div>
                `;
            });
            document.getElementById('action-container').innerHTML = config.renderActions();
            config.matrices.forEach(id => generateGrid(id.replace('_square', ''), id === 'A_square'));
            hideResult();
        }

        function generateGrid(id, isSquare) {
            const rInput = document.getElementById(`rows-${id}`);
            const cInput = document.getElementById(`cols-${id}`);
            if(isSquare) cInput.value = rInput.value;
            const rows = parseInt(rInput.value), cols = parseInt(cInput.value);
            const grid = document.getElementById(`grid-${id}`);
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${cols}, 50px)`;
            for(let i=0; i<rows*cols; i++) {
                let val = (id==='A' && i===0) || (id==='B' && i===1) || (id==='C' && i===2) ? 1 : 0;
                grid.innerHTML += `<input type="number" class="matrix-cell" value="${val}" onfocus="this.select()">`;
            }
        }

        function getMatrix(id) {
            const el = document.getElementById(`rows-${id}`);
            if(!el) return null;
            const r = parseInt(el.value), c = parseInt(document.getElementById(`cols-${id}`).value);
            const inputs = document.getElementById(`grid-${id}`).getElementsByTagName('input');
            let mat = [];
            for(let i=0; i<r; i++) {
                let row = [];
                for(let j=0; j<c; j++) row.push(Number(inputs[i*c+j].value) || 0);
                mat.push(row);
            }
            return mat;
        }

        // ê°€ìš°ìŠ¤ ì†Œê±°ë²• ì½”ì–´ ì—”ì§„ (í™•ì¥ í–‰ë ¬ ì§€ì›)
        function computeRREF(matrix, isAugmented = false) {
            let m = matrix.map(row => [...row]);
            let rows = m.length, cols = m[0].length;
            let lead = 0;
            let steps = [];
            let pivotCols = [];

            steps.push(`ì´ˆê¸° í–‰ë ¬ êµ¬ì„±:\n ${formatTeX(m)}`);

            for (let r = 0; r < rows; r++) {
                // ì—­í–‰ë ¬ ëª¨ë“œì¼ ë•Œ ì™¼ìª½ ì •ë°©í–‰ë ¬ ë¶€ë¶„ë§Œ í”¼ë²—ìœ¼ë¡œ íƒìƒ‰
                let searchCols = isAugmented ? rows : cols; 
                if (searchCols <= lead) break;
                
                let i = r;
                while (m[i][lead] === 0) {
                    i++;
                    if (rows === i) { i = r; lead++; if (searchCols === lead) return { rref: m, steps, pivotCols }; }
                }
                
                if (i !== r) {
                    let temp = m[i]; m[i] = m[r]; m[r] = temp;
                    steps.push(`í–‰ êµí™˜ ($R_{${r+1}} \\leftrightarrow R_{${i+1}}$):\n ${formatTeX(m)}`);
                }

                let val = m[r][lead];
                if(val !== 1) {
                    for (let j = 0; j < cols; j++) m[r][j] /= val;
                    steps.push(`Pivotì„ 1ë¡œ ë§Œë“¤ê¸° ($R_{${r+1}} \\leftarrow R_{${r+1}} / ${math.round(val,3)}$):\n ${formatTeX(m)}`);
                }
                pivotCols.push(lead);

                let changed = false;
                for (let k = 0; k < rows; k++) {
                    if (k === r) continue;
                    val = m[k][lead];
                    if(val !== 0) {
                        for (let j = 0; j < cols; j++) m[k][j] -= val * m[r][j];
                        changed = true;
                        steps.push(`ì†Œê±° ($R_{${k+1}} \\leftarrow R_{${k+1}} - (${math.round(val,3)})R_{${r+1}}$):\n ${formatTeX(m)}`);
                    }
                }
                lead++;
            }
            return { rref: m, steps, pivotCols };
        }

        function evaluateExpression() {
            hideResult();
            const expr = document.getElementById('custom-expr').value;
            try {
                const scope = { A: getMatrix('A'), B: getMatrix('B'), C: getMatrix('C') };
                const result = math.evaluate(expr, scope);
                
                let methodMsg = "ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ìˆ˜ì‹ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆœì°¨ì ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.";
                showResult(`\\text{Result} = ${formatTeX(result)}`, methodMsg, null);
            } catch(e) { showError("ìˆ˜ì‹ ì˜¤ë¥˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."); }
        }

        function runRREF(mode) {
            hideResult();
            try {
                const A = getMatrix('A');
                const { rref, steps, pivotCols } = computeRREF(A);
                
                let tex = "";
                let methodMsg = "<b>ê°€ìš°ìŠ¤-ì¡°ë¥´ë‹¨ ì†Œê±°ë²• (Gauss-Jordan Elimination)</b>ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì•½ í–‰ ì‚¬ë‹¤ë¦¬ê¼´ì„ êµ¬í–ˆìŠµë‹ˆë‹¤.";
                let stepHTML = steps.map((s, idx) => `<div style="margin-bottom:15px;"><b>[Step ${idx}]</b><br>${katex.renderToString(s)}</div>`).join('');

                if (mode === 'rref') {
                    tex = `\\text{RREF}(A) = ${formatTeX(rref)}`;
                } else if (mode === 'col_basis') {
                    methodMsg = "ê°€ìš°ìŠ¤ ì†Œê±°ë²•ìœ¼ë¡œ RREFë¥¼ êµ¬í•œ ë’¤, <b>Pivotì´ ìœ„ì¹˜í•œ ì—´(Column)</b>ì„ ê¸°ì¤€ìœ¼ë¡œ ì›ë³¸ í–‰ë ¬ Aì˜ ì—´ ë²¡í„°ë“¤ì„ ì¶”ì¶œí•˜ì—¬ ì—´ ê³µê°„ì˜ ê¸°ì €ë¥¼ êµ¬í–ˆìŠµë‹ˆë‹¤.";
                    let basis = pivotCols.map(c => A.map(row => row[c]));
                    let basisTex = basis.map(v => formatTeX(v.map(x=>[x]))).join(', \\; ');
                    tex = `\\text{Basis of Col}(A) = \\{ ${basisTex} \\}`;
                }
                showResult(tex, methodMsg, stepHTML);
            } catch(e) { showError(e.message); }
        }

        // ì—­í–‰ë ¬ ë‹¨ê³„ë³„ í’€ì´ í•¨ìˆ˜
        function runInverseSteps() {
            hideResult();
            try {
                const A = getMatrix('A');
                if (A.length !== A[0].length) throw new Error("ì—­í–‰ë ¬ì€ ì •ë°©í–‰ë ¬ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                if (math.det(A) === 0) throw new Error("í–‰ë ¬ì‹ì´ 0ì´ë¯€ë¡œ ì—­í–‰ë ¬ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");

                let n = A.length;
                // [A | I] ì²¨ê°€ í–‰ë ¬ ë§Œë“¤ê¸°
                let augMat = A.map((row, i) => {
                    let newRow = [...row];
                    for (let j = 0; j < n; j++) newRow.push(i === j ? 1 : 0);
                    return newRow;
                });

                const { rref, steps } = computeRREF(augMat, true);
                
                // ì˜¤ë¥¸ìª½ nê°œ ì—´(ì—­í–‰ë ¬ ë¶€ë¶„) ì¶”ì¶œ
                let invMat = rref.map(row => row.slice(n));

                let methodMsg = "<b>ì²¨ê°€ í–‰ë ¬ê³¼ ê°€ìš°ìŠ¤-ì¡°ë¥´ë‹¨ ì†Œê±°ë²•</b>ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.<br>ì›ë³¸ í–‰ë ¬ ì˜†ì— í•­ë“± í–‰ë ¬ $[A | I]$ ì„ ë¶™ì¸ í›„, í–‰ ì—°ì‚°ì„ í†µí•´ ì™¼ìª½ì„ í•­ë“± í–‰ë ¬ë¡œ ë§Œë“¤ë©´ ì˜¤ë¥¸ìª½ì´ ì—­í–‰ë ¬ $[I | A^{-1}]$ ì´ ë©ë‹ˆë‹¤.";
                let stepHTML = steps.map((s, idx) => `<div style="margin-bottom:15px;"><b>[Step ${idx}]</b><br>${katex.renderToString(s)}</div>`).join('');

                showResult(`A^{-1} = ${formatTeX(invMat)}`, methodMsg, stepHTML);
            } catch(e) { showError(e.message); }
        }

        function calcStandard(op) {
            hideResult();
            try {
                const A = getMatrix('A');
                let tex = "", methodMsg = "";
                if(op === 'det') {
                    tex = `\\det(A) = ${math.round(math.det(A), 4)}`;
                    methodMsg = "í–‰ë ¬ì‹ ê³„ì‚°ì—ëŠ” ì—¬ì¸ìˆ˜ ì „ê°œ(Cofactor Expansion) ë° ë‚´ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì•Œê³ ë¦¬ì¦˜ì´ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.";
                } else if(op === 'eigen') {
                    const eig = math.eigs(A);
                    tex = `\\text{Eigenvalues } (\\lambda) = [ ${eig.values.map(v => math.round(v,4)).join(', ')} ]`;
                    methodMsg = "íŠ¹ì„± ë°©ì •ì‹ $\\det(A - \\lambda I) = 0$ ì„ í’€ì–´ ê³ ìœ³ê°’ì„ ë„ì¶œí–ˆìŠµë‹ˆë‹¤.";
                }
                showResult(tex, methodMsg, null);
            } catch(e) { showError("ê³„ì‚° ë¶ˆê°€: ì •ë°©í–‰ë ¬ì´ ì•„ë‹ˆê±°ë‚˜ íŠ¹ì´í–‰ë ¬ì…ë‹ˆë‹¤."); }
        }

        function formatTeX(mat) {
            if(typeof mat === 'number') return math.round(mat, 4).toString();
            if(!Array.isArray(mat)) return mat.toString();
            if(!Array.isArray(mat[0])) mat = mat.map(v => [v]); 
            return `\\begin{bmatrix} ${mat.map(row => row.map(v => math.round(v,4)).join(' & ')).join(' \\\\ ')} \\end{bmatrix}`;
        }
        
        function hideResult() { 
            document.getElementById('result-area').style.display = 'none'; 
            document.getElementById('error-display').innerText = ''; 
        }
        
        function showResult(tex, methodText, stepsHTML) {
            // ìˆ˜í•™ ê°œë… ì„¤ëª… ì¶œë ¥
            const descDiv = document.getElementById('method-desc');
            if (methodText) {
                descDiv.innerHTML = `<strong>ğŸ’¡ ì‚¬ìš©ëœ ê°œë…:</strong> ${methodText}`;
                descDiv.style.display = 'block';
            } else {
                descDiv.style.display = 'none';
            }

            // ìµœì¢… ìˆ˜ì‹ ë Œë”ë§
            katex.render(tex, document.getElementById('katex-display'), { displayMode: true });
            
            // ë‹¨ê³„ë³„ í’€ì´ ì¶œë ¥ ì œì–´
            const stepsDiv = document.getElementById('solution-steps');
            if (stepsHTML) {
                stepsDiv.innerHTML = stepsHTML;
            } else {
                stepsDiv.innerHTML = `<span class="no-step-msg">ì´ ì—°ì‚°ì€ ë‹¨ì¼ ê³µì‹ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ ë‹¨ê³„ë³„ í–‰ ì—°ì‚° ê³¼ì •ì´ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ìµœì¢… ê²°ê³¼ë§Œ ì œê³µë¨)</span>`;
            }
            
            document.getElementById('result-area').style.display = 'block';
        }
        function showError(msg) {
            document.getElementById('error-display').innerText = msg;
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('katex-display').innerHTML = '';
            document.getElementById('method-desc').style.display = 'none';
            document.getElementById('solution-steps').innerHTML = '';
        }

        window.onload = () => { renderUI(); };
    </script>
</body>
</html>